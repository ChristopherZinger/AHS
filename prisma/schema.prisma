generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Profile {
  id                  String        @id @default(uuid())
  comments            Comment[]
  subcomments         Subcomment[]
  votes               Vote[]
  user                User @relation(fields: [userId], references: [id])
  userId              String @unique 
}

enum USER_ROLE {
  ADMIN
  STANDARD
}

model AnonymousSession {
  id              String      @id @default(uuid())
  createdAt       DateTime    @default(now())
  expirationDate  DateTime  
  surveys         Survey[]
}

model Survey {
  id                  String            @id @default(uuid())
  createdAt           DateTime          @default(now())
  data                Json
  anonymousSession    AnonymousSession  @relation(fields: [anonymousSessionId], references: [id]) 
  anonymousSessionId  String
}

model User {
  id                  String        @id @default(uuid())
  email               String        @unique
  hashedPassword      String
  role                USER_ROLE     
  profile Profile?
}


// ENTITIES - SCHOOL or OFFICE
enum EntityType  {
  SCHOOL
  OFFICE
}

model Entity {
  id                  String        @id @default(uuid())
  slug                String        
  type                EntityType
  name                String   
  aliases             Alias[]
  isVerified          Boolean
  city                City          @relation(fields: [cityId], references: [id]) 
  cityId              String
  comments            Comment[]
  redFlagSurveys      RedFlagSurvey[]
  redFlagCounters     RedFlagCounter[]
}

model Alias {
  id                String      @id @default(uuid())
  entityType        EntityType
  name              String
  entity            Entity      @relation(fields: [entityId], references: [id]) 
  entityId          String
}

// COMMENT
model Comment {
  id                String    @id @default(uuid()) 
  author            Profile   @relation(fields: [authorId], references: [id])
  authorId          String  
  entity            Entity    @relation(fields:[entityId], references: [id])
  entityId          String 
  createdAt         DateTime  @default(now()) 
  votes             Vote[]
  content           String    @db.VarChar(4000)
  title             String    @db.VarChar(90)
  isReviewed        Boolean   @default(false) 
  subcomments       Subcomment[]
}

model Subcomment {
  id                String  @id @default(uuid())
  author            Profile   @relation(fields: [authorId], references: [id])
  authorId          String  
  content           String   @db.VarChar(1500)
  createdAt         DateTime  @default(now()) 
  parentComment     Comment    @relation(fields:[parentCommentId], references: [id])
  parentCommentId   String 
}

enum VoteType {
  UP
  DOWN
}

model Vote {
  id          String    @id @default(uuid())
  comment     Comment   @relation(fields: [commentId], references: [id])
  commentId   String
  profile     Profile   @relation(fields: [profileId], references: [id])
  profileId   String
  type        VoteType
  createdAt   DateTime  @default(now())
}

// LOCATION
model City {
    id              String      @id @default(uuid())
    isVerified      Boolean     
		name            String     
    slug            String
		countryAlpha2   String
		country         Country     @relation(fields: [countryAlpha2], references: [alpha2]) 
    offices         Entity[]
}

model Country {
  id                  String      @id @default(uuid())
	name                String  
  alpha2              String      @unique 
  cities              City[]
  region              Region      @relation(fields: [regionSlug], references: [slug])
  regionSlug          String
}

model Region  {
  slug                  String        @id
  name                  String
  countries             Country[]
}

model RedFlagCounter {
  id                String    @id @default(uuid())
  entity            Entity    @relation(fields:[entityId], references: [id])
  entityId          String 
  redFlagName       RedFlag 
  counter           Int
}

model RedFlagSurvey {
  id                  String       @id @default(uuid())
  redFlags            RedFlag[]
  entity              Entity        @relation(fields:[entityId], references: [id])
  entityId            String 
  createdAt           DateTime      @default(now()) 
}

enum RedFlag {
  UNPAID_INTERNSHIP 
  UNPAID_OVERTIME
  STARVING_SALARY
  OVERDUE_PAYOUT
  PAYSLIP_LOWER_THEN_AGREED
  GETTING_RAISE_IS_IMPOSSIBLE
  UNPAID_EXPENSES

  BORING_PROJECTS
  UNREALISTIC_DEADLINES
  TASK_DONT_MATCH_JOB_DESCRIPTION
  MONOTONOUS_TASKS
  CHEAPEST_SOLUTIONS_AND_BASIC_DESIGN

  TOO_MUCH_RESPONSIBILITY
  TOO_LITTLE_RESPONSIBILITY
  NO_ROOM_FOR_DEVELOPMENT
  CANT_GET_MEANINGFUL_EXPERIENCE
  GLASS_CEILING

  MISSING_OR_STUDENTS_LICENSE
  REQUIRED_PRIVATE_HARDWARE_OR_SOFTWARE
  OFF_BRAND_OR_FREE_SOFTWARE  
  OLD_HARDWARE_OUTDATED_SOFTWARE
  BAD_WORKSPACE
  MISSING_BASIC_MATERIALS

  ABUSE_MOBBING
  TOXIC_ATMOSPHERE
  STRESS_PRESSURE
  FAVORITISM
  INTERNS_MAJORITY
  NARCISSISTIC_MANAGEMENT
  MICROMANAGEMENT
  TRASH_CONTRACTS

  CASUAL_OVERTIME
  SYSTEMATIC_OVERTIME
  WEEKEND_WORK
  DENIED_TIME_OFF

  RACISM
  HOMOPHOBIA
  ABLEISM
  XENOPHOBIA
  TRANSPHOBIA
  NEPOTISM
  SEXISM
  AGISM
}
